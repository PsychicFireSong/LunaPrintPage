<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luna's Print Page - Photography</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Title Bar -->
    <div class="title-bar">
        <video class="title-video" autoplay loop muted playsinline>
            <source src="images/Title.mp4" type="video/mp4">
        </video>
        <div class="title-overlay">
            <h1 class="title-text">Each Moment a Memory</h1>
        </div>
    </div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <a href="index.html" class="nav-link">Home</a>
        <a href="stickers.html" class="nav-link">Stickers</a>
        <a href="prints.html" class="nav-link">Prints</a>
        <a href="photography.html" class="nav-link active">Photography</a>
        <a href="artwork.html" class="nav-link">Artwork</a>
        <a href="#" class="nav-link">About me</a>
    </div>

    <!-- Navigation Bar (Desktop) -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-link">Home</a>
            <a href="stickers.html" class="nav-link">Stickers</a>
            <a href="prints.html" class="nav-link">Prints</a>
            <a href="photography.html" class="nav-link active">Photography</a>
            <a href="artwork.html" class="nav-link">Artwork</a>
            <a href="#" class="nav-link">About me</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Section 1: Introduction -->
        <section class="fade-in">
            <div class="full-width-box">
                <h2 class="text-box-title">My World Through The Lens</h2>
                <p>I've been shooting since 2014, starting on a humble Instax mini camera which I used to capture memories for keepsake while on vacations. Today, i shoot many subjects. From birds, people, landscapes, and our fluffy friends (in both interpretations of the word), i point my camera and click whenever the chance arises. I aim to capture the decisive moment when I'm out and about, getting the most interesting subjects and scenes. Meanwhile in the studio, I place a steady hand on my lights and camera to shoot with clinical precision. You can find my work here.</p>
            </div>
        </section>

        <!-- Section 2: Photo Gallery -->
        <section class="gallery-section fade-in" style="margin-top: 3rem;">
            <div class="gallery-container">
                <div class="gallery-header">
                    <div class="gallery-filters">
                        <div class="filter-group">
                            <label for="yearFilter">Year:</label>
                            <select id="yearFilter" class="filter-select">
                                <option value="all">All Years</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="categoryFilter">Category:</label>
                            <select id="categoryFilter" class="filter-select">
                                <option value="all">All</option>
                                <option value="furry">Furry</option>
                                <option value="non-furry">Non-Furry</option>
                            </select>
                        </div>
                    </div>
                    <div class="privacy-tooltip">
                        <span class="privacy-trigger">Privacy and Fair Use</span>
                        <div class="privacy-content">
                            <div class="privacy-column">
                                <h4>Privacy Notice</h4>
                                <p>All images taken in a private setting (e.g. our studio, planned shoots) are posted with permission from the persons involved. All images taken in conventions or public spaces are declared as fair use, takedowns can be requested via personal messages on Telegram.</p>
                            </div>
                            <div class="privacy-column">
                                <h4>Fair Use Policy</h4>
                                <p>Users of this webpage are allowed to copy or download the images shown in the gallery for non-commercial purposes. For any posts made using images shown here, accreditation should be given to LunaTheDergn(@PsychicFireSong) where valid. Usage of images from this collection in any illegal activities are not permitted.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pagination Controls (Top) -->
                <div class="pagination-controls" id="paginationTop"></div>

                <div id="gallery" class="photo-gallery">
                    <!-- Gallery items will be dynamically loaded here -->
                </div>

                <!-- Pagination Controls (Bottom) -->
                <div class="pagination-controls" id="paginationBottom"></div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Luna's Print Page. All rights reserved.</p>
        </div>
    </footer>

    <!-- Image Modal -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close-modal">&times;</span>
        <img id="modalImage" class="modal-content">
    </div>

    <!-- Include gallery configuration -->
    <script src="gallery-config.js"></script>

    <script>
        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileOverlay = document.getElementById('mobileOverlay');
        
        function toggleMobileMenu() {
            mobileMenu.classList.toggle('active');
            mobileOverlay.classList.toggle('active');
        }
        
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        mobileOverlay.addEventListener('click', toggleMobileMenu);

        // Fade-in on scroll animation
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

        // Gallery data loaded from gallery-config.js
        // galleryImages is already declared in gallery-config.js
        
        // Pagination settings
        const ITEMS_PER_PAGE = 100;
        let currentPage = 1;
        let filteredImages = [];
        
        // Lazy loading observer
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    const src = img.dataset.src;
                    if (src) {
                        img.src = src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                }
            });
        }, {
            rootMargin: '10%' // Load images when they're 10% away from viewport
        });
        
        // Check if gallery images are loaded
        if (typeof galleryImages === 'undefined' || !galleryImages || galleryImages.length === 0) {
            console.error('Gallery images not loaded or empty!');
            document.getElementById('gallery').innerHTML = '<p class="no-results">Error: Gallery images not loaded. Please check gallery-config.js</p>';
        }

        // Extract unique years from images
        function populateYearFilter() {
            const years = [...new Set(galleryImages.map(img => {
                const date = new Date(img.date);
                return date.getFullYear();
            }))].sort((a, b) => b - a);

            const yearFilter = document.getElementById('yearFilter');
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }

        // Filter and display gallery
        function filterGallery() {
            const yearFilter = document.getElementById('yearFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            filteredImages = galleryImages.filter(img => {
                const imgYear = new Date(img.date).getFullYear().toString();
                const yearMatch = yearFilter === 'all' || imgYear === yearFilter;
                const categoryMatch = categoryFilter === 'all' || img.category === categoryFilter;
                return yearMatch && categoryMatch;
            });

            currentPage = 1; // Reset to first page on filter change
            displayGallery();
            updatePaginationControls();
        }

        // Display gallery with masonry-style layout and pagination
        function displayGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            if (filteredImages.length === 0) {
                gallery.innerHTML = '<p class="no-results">No images found for the selected filters.</p>';
                return;
            }

            // Calculate pagination
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, filteredImages.length);
            const pageImages = filteredImages.slice(startIndex, endIndex);

            pageImages.forEach((img) => {
                const item = document.createElement('div');
                item.className = `gallery-item aspect-${img.aspect}`;
                
                const imgElement = document.createElement('img');
                imgElement.dataset.src = img.thumbnail; // Use data-src for lazy loading
                imgElement.alt = 'Photography';
                imgElement.dataset.full = img.path;
                imgElement.onerror = function() {
                    this.onerror = null;
                    this.src = img.path;
                };
                
                // Observe image for lazy loading
                imageObserver.observe(imgElement);
                
                item.appendChild(imgElement);
                item.addEventListener('click', () => openImageModal(img.path));
                gallery.appendChild(item);
            });
            
            // Scroll to top of gallery on page change
            if (currentPage > 1) {
                document.querySelector('.gallery-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Open image in modal
        function openImageModal(imagePath) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            
            modal.style.display = 'flex';
            modalImg.src = imagePath;
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Prevent modal from closing when clicking the image
        document.getElementById('modalImage').addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // Pagination controls
        function updatePaginationControls() {
            const totalPages = Math.ceil(filteredImages.length / ITEMS_PER_PAGE);
            const paginationHTML = createPaginationHTML(totalPages);
            
            document.getElementById('paginationTop').innerHTML = paginationHTML;
            document.getElementById('paginationBottom').innerHTML = paginationHTML;
            
            // Add event listeners to all pagination buttons
            document.querySelectorAll('.page-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentPage = parseInt(btn.dataset.page);
                    displayGallery();
                    updatePaginationControls();
                });
            });
            
            document.querySelectorAll('.prev-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        displayGallery();
                        updatePaginationControls();
                    }
                });
            });
            
            document.querySelectorAll('.next-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayGallery();
                        updatePaginationControls();
                    }
                });
            });
            
            document.querySelectorAll('.goto-input').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const page = parseInt(input.value);
                        if (page >= 1 && page <= totalPages) {
                            currentPage = page;
                            displayGallery();
                            updatePaginationControls();
                        } else {
                            alert(`Please enter a page number between 1 and ${totalPages}`);
                        }
                    }
                });
            });
        }
        
        function createPaginationHTML(totalPages) {
            if (totalPages <= 1) return '';
            
            let html = '<div class="pagination-wrapper">';
            
            // Previous button
            html += `<button class="pagination-btn prev-btn" ${currentPage === 1 ? 'disabled' : ''}>← Previous</button>`;
            
            // Page numbers
            html += '<div class="page-numbers">';
            
            // Always show first page
            if (currentPage > 3) {
                html += `<button class="pagination-btn page-btn ${currentPage === 1 ? 'active' : ''}" data-page="1">1</button>`;
                if (currentPage > 4) html += '<span class="page-ellipsis">...</span>';
            }
            
            // Show pages around current page
            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                html += `<button class="pagination-btn page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">${i}</button>`;
            }
            
            // Always show last page
            if (currentPage < totalPages - 2) {
                if (currentPage < totalPages - 3) html += '<span class="page-ellipsis">...</span>';
                html += `<button class="pagination-btn page-btn ${currentPage === totalPages ? 'active' : ''}" data-page="${totalPages}">${totalPages}</button>`;
            }
            
            html += '</div>';
            
            // Next button
            html += `<button class="pagination-btn next-btn" ${currentPage === totalPages ? 'disabled' : ''}>Next →</button>`;
            
            // Go to page input
            html += '<div class="goto-page">';
            html += '<label>Go to page:</label>';
            html += `<input type="number" class="goto-input" min="1" max="${totalPages}" placeholder="#">`;
            html += `<span class="page-info">of ${totalPages}</span>`;
            html += '</div>';
            
            html += '</div>';
            return html;
        }

        // Event listeners for filters
        document.getElementById('yearFilter').addEventListener('change', filterGallery);
        document.getElementById('categoryFilter').addEventListener('change', filterGallery);

        // Initialize gallery
        populateYearFilter();
        filterGallery();
    </script>
</body>
</html>
